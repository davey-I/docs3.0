<!DOCTYPE html>
<html><head>
<title data-folder-path="/Tocco">Maintenance-Window</title>
<link href=" ../../static/style.css" rel="stylesheet"/>
<link href="../../prism/prism.css" rel="stylesheet"/>
</head>
<body class="body">
<div class="page-folder-header-div">
<h1 class="pagetitle" data-folder-path="Tocco">Maintenance-Window</h1>
<a href="./../..">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M3 11L12 4L21 11"></path>
<path d="M5 10V20H19V10"></path>
<path d="M10 20V14H14V20"></path>
</svg>
</a>
</div>
<!-- Sidebar -->
<div class="sidbear-enclosure-open" id="sidbear-enclosure-open-Maintenance-Window">
<button class="sidbear-enclosure-button-open" id="sidbear-enclosure-button-Maintenance-Window" onclick="toggle_sidebar()" type="button">
<svg fill="white" height="30" viewBox="0 0 100 80" width="30" xmlns="http://www.w3.org/2000/svg">
<rect height="10" width="100"></rect>
<rect height="10" width="100" y="30"></rect>
<rect height="10" width="100" y="60"></rect>
</svg>
</button>
<div class="sidebar-mainbox-open" id="sidebar-mainbox-Maintenance-Window">
<div class="sidebar-subbox-open" id="sidebar-subbox-1" onclick=" append_foldable_content()">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" x2="12" y1="8" y2="16"></line>
<line x1="8" x2="16" y1="12" y2="12"></line>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-2">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-3">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
</div>
</div>
<script src="../../prism/prism.js"></script>
<script src="../../static/script.js"></script>
<!--## GoodToKnow-Errors-Problems #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-GoodToKnow-Errors-Problems">
<h2 class="foldable-title" id="foldable-title-GoodToKnow-Errors-Problems">GoodToKnow-Errors-Problems</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('GoodToKnow-Errors-Problems')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Maintenance-Window','editable-paragraph-GoodToKnow-Errors-Problems', 'foldable-content-penButton-GoodToKnow-Errors-Problems')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-GoodToKnow-Errors-Problems" onclick="add_subdiv('editable-paragraph-GoodToKnow-Errors-Problems')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-GoodToKnow-Errors-Problems">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-GoodToKnow-Errors-Problems" onclick="save_editable_content('Maintenance-Window','editable-paragraph-GoodToKnow-Errors-Problems', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-GoodToKnow-Errors-Problems"><!--## Teamcity-Schema-Change #################################################################################################################--><div class="foldable-container" id="foldcontainer-Teamcity-Schema-Change">
<h2 class="foldable-title" id="foldable-title-Teamcity-Schema-Change">Teamcity-Schema-Change</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Teamcity-Schema-Change')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Maintenance-Window','editable-paragraph-Teamcity-Schema-Change', 'foldable-content-penButton-Teamcity-Schema-Change')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Teamcity-Schema-Change">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Teamcity-Schema-Change" onclick="save_editable_content('Maintenance-Window','editable-paragraph-Teamcity-Schema-Change', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Teamcity-Schema-Change"><pre>- After running the auto update playbook, Teamcity won't start on its own and
  displays a message with a option "i am admin or something" if we open this 
  it asks for a <b>Super User token</b>.

- Easiest way to find it is to just log into tc.tocco.ch via ssh, then the Token should
   be displayed at the welcome screen:
<pre><code class="lang-bash">ssh tc.tocco.ch
# if not , do the thing from underneath here
</code></pre>

- This always happens when a <b>schema change</b> occurs on the Teamcity
 and unfortunately this interrupts the automation process, because in order to start the
 requested upgrade (and generally to get into the window shown above) a
 Super User Token must be retrieved from the logs.


- We can find this token via :

<pre><code class="lang-bash">
ssh tc.tocco.ch
cd /home/tocco/teamcity/logs
vim teamcity-server.log
</code>
</pre>

- Once we entered the token, we see another message where we can start the
 backup process and the final schema change. After this Teamcity should start
 on its own again.
</pre></div>
</div>
</div>
<!--## TC-Gerrit-Verification-Error #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-TC-Gerrit-Verification-Error">
<h2 class="foldable-title" id="foldable-title-TC-Gerrit-Verification-Error">TC-Gerrit-Verification-Error</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('TC-Gerrit-Verification-Error')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Maintenance-Window','editable-paragraph-TC-Gerrit-Verification-Error', 'foldable-content-penButton-TC-Gerrit-Verification-Error')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-TC-Gerrit-Verification-Error">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-TC-Gerrit-Verification-Error" onclick="save_editable_content('Maintenance-Window','editable-paragraph-TC-Gerrit-Verification-Error', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-TC-Gerrit-Verification-Error"><pre>- After the maintenance Window on Fr, a hook that usually triggers the auto. verification on
Teamcity did't work anymore

- This was noticed by users, trying to commit stuff on Gerrit. Because there were no more checkmark on (V)
</pre>
<img alt="gerrit_verification_" height="600" src="../../images/gerrit_verification_1.png" width="500"/></div>
</div>
</div>


<div class="foldable-container" id="foldcontainer-Artifactory-Space-Issues">
<h2 class="foldable-title" id="foldable-title-Artifactory-Space-Issues">Artifactory-Space-Issues</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Artifactory-Space-Issues')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Maintenance-Window','editable-paragraph-Artifactory-Space-Issues', 'foldable-content-penButton-Artifactory-Space-Issues')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Artifactory-Space-Issues">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Artifactory-Space-Issues" onclick="save_editable_content('Maintenance-Window','editable-paragraph-Artifactory-Space-Issues', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Artifactory-Space-Issues"><h2>Sometimes Artifactory s apt cache fills up</h2>
<pre><h3>🧠 Breakdown of the Failure</h3>

<h3>✅ Step 1: APT downloads the <code>.deb</code> files</h3>
<ul>
  <li>APT successfully downloaded <code>jfrog-artifactory-oss_7.117.5_amd64.deb</code>
 and other related packages into <b>/var/cache/apt/archives/</b>.
</li>
</ul>
<h3>✅ Step 2: APT starts the upgrade</h3>
<ul>
  <li>APT begins unpacking the new <code>.deb</code> packages using <code>dpkg</code>.</li>
</ul>
<h3>⚠️ Step 3: <code>dpkg</code> tries to install Artifactory</h3>
<ul>
  <li>This is the critical point of failure:</li>
  <li>APT attempts to unpack and overwrite the existing Artifactory version:</li>
  <li><code>Unpacking jfrog-artifactory-oss (7.117.5) over (7.111.11) ...</code></li>
  <li>Then it fails with:</li>
  <li><code>cannot copy extracted data for './opt/jfrog/artifactory/app/router/bin/jf-router'
to '/opt/jfrog/artifactory/app/router/bin/jf-router.dpkg-new': failed to 
write (No space left on device)</code></li>
  <li>This means that <code>/</code> (root filesystem) ran out of space during the unpack phase.</li>
</ul>
<h3>❌ Step 4: <code>dpkg</code> aborts the install of that package</h3>
<ul>
  <li>The paste subprocess dies due to disk space exhaustion:</li>
  <li><code>dpkg-deb: error: paste subprocess was killed by signal (Broken pipe)</code></li>
  <li>APT logs the error:</li>
  <li><code>Errors were encountered while processing: jfrog-artifactory-oss_7.117.5_amd64.deb</code></li>
</ul>
<h3>💥 Why This Stops Everything</h3>
<ul>
  <li><code>dpkg</code> is a low-level package tool — if it fails to unpack, it stops immediately.</li>
  <li><code>apt</code> exits with error code <code>100</code>, which in turn
causes your Ansible playbook to fail with:</li>
  <li><code>FAILED! =&gt; changed: false msg: '/usr/bin/apt-get dist-upgrade --auto-remove' failed...</code></li>
</ul>
<h3>🔁 Recovery Path</h3>
<ul>
  <li>After freeing up space with <b>apt clean</b>, the system is left in a half-upgraded state.</li>
  <li>To recover, run the following commands manually or via Ansible:</li>
  <li><code>sudo dpkg --configure -a</code></li>
  <li><code>sudo apt-get install -f</code></li>
  <li><code>sudo apt-get dist-upgrade</code></li>
</ul>
<h3>🧹 Optional Preventive Steps</h3>
<ul>
  <li>Regularly clean APT cache using <code>apt-get clean</code>.</li>
  <li>Monitor disk space on <code>/</code> using cron, monitoring tools, or Ansible.</li>
  <li>Consider configuring Artifactory-related directories to live on larger,
dedicated partitions or volumes.</li>
</ul>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<!--## Automation-Scripts #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Automation-Scripts">
<h2 class="foldable-title" id="foldable-title-Automation-Scripts">Automation-Scripts</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Automation-Scripts')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Maintenance-Window','editable-paragraph-Automation-Scripts', 'foldable-content-penButton-Automation-Scripts')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Automation-Scripts" onclick="add_subdiv('editable-paragraph-Automation-Scripts')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Automation-Scripts">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Automation-Scripts" onclick="save_editable_content('Maintenance-Window','editable-paragraph-Automation-Scripts', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Automation-Scripts"><!--## DB-Dumps-Burp-Archives #################################################################################################################--><div class="foldable-container" id="foldcontainer-DB-Dumps-Burp-Archives">
<h2 class="foldable-title" id="foldable-title-DB-Dumps-Burp-Archives">DB-Dumps-Burp-Archives</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('DB-Dumps-Burp-Archives')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Maintenance-Window','editable-paragraph-DB-Dumps-Burp-Archives', 'foldable-content-penButton-DB-Dumps-Burp-Archives')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-DB-Dumps-Burp-Archives">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-DB-Dumps-Burp-Archives" onclick="save_editable_content('Maintenance-Window','editable-paragraph-DB-Dumps-Burp-Archives', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-DB-Dumps-Burp-Archives"><html><head></head><body><pre><h3>! Delete the Old file first  !</h3>
- script name <i>maintenance_ssh_commands.sh</i>

- This automates the two tasks <b>verify DB dumps VSHN:</b> and <b>verify Burp archives VSHN:</b>

- The <b>Old file</b> in this folder has to me <b>removed first</b> otherwise the script "hänngt irgendwie gegen ende"

<pre><code class="lang-bash">
#!/bin/bash


servers_1=(
  "db6.stage.tocco.cust.vshn.net"
  "db2.prod.tocco.cust.vshn.net"
  "db4.tocco.cust.vshn.net"
  "db8.prod.tocco.cust.vshn.net"
  "db2.stage.tocco.cust.vshn.net"
)


touch DB_dumps_VSHN


for i in "${servers_1[@]}"
do
  echo "====================================================================================================" &gt;&gt; DB_dumps_VSHN
  echo "Server: $i :" &gt;&gt; DB_dumps_VSHN
  ssh "$i" "ls -lht /var/lib/postgresql-backup/; sudo burp -a list -Q" &gt;&gt; DB_dumps_VSHN
  echo "====================================================================================================" &gt;&gt; DB_dumps_VSHN
  echo "" &gt;&gt; DB_dumps_VSHN
done


</code>
</pre>
- And saves the output in a file called <b>DB_dumps_VSHN</b> at the location where the command was executed

- The script is located at <b>/home/dave/src/bash_srcipts_loco</b>
</pre></body></html></div>
</div>
</div>
</div>
</div>
</div>
<!--## Main-Tasks #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Main-Tasks">
<h2 class="foldable-title" id="foldable-title-Main-Tasks">Main-Tasks</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Main-Tasks')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Maintenance-Window','editable-paragraph-Main-Tasks', 'foldable-content-penButton-Main-Tasks')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Main-Tasks" onclick="add_subdiv('editable-paragraph-Main-Tasks')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Main-Tasks">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Main-Tasks" onclick="save_editable_content('Maintenance-Window','editable-paragraph-Main-Tasks', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Main-Tasks"><pre><h3>Borg</h3>
- Check age and number of files and be sure to verify:
Archives with prefix postgres- (database backups).
<pre><code class="lang-bash">

cd ${ANSIBLE_GIT_REPO_ROOT_DIRECTORY}/servers/
ansible-playbook playbooks/backup_check/main.yml
</code>
</pre>
<h3>DB dumps VSHN / Burp archives VSHN</h3>
- use script from <b>Automation-Scripts</b> above

<h3>Offline backups</h3>
- Make sure there is a recent snapshot (from yesterday or today).
<pre><code class="lang-bash">
ssh backup02.tocco.ch 'sudo mount /offline; ls /offline/borg_repos; sudo umount /offline'
</code>
</pre>
<h3>Check Snapshots</h3>
- RSYNC: check uage history at: <a href="https://www.rsync.net/am/view_usage_hist.html?uid=zh2366"> rsync.net </a>

<h3>Check for unused DBs and cleanup if necessary:</h3>
<i>tco dbs unused</i>

<h3>Check error and info logs of autorestore-vm:</h3>
<pre><code class="lang-bash">
ssh autorestore.tocco.ch 'sudo cat /home/autorestore/info.log'

ssh autorestore.tocco.ch 'sudo cat /home/autorestore/error.log'
</code>
</pre>

<h3>Check Gerrit updates</h3>
<ul>
<li>Updates are not fully automated and checking for updates and installing needs to be done manually.</li>

<li>check installed version on https://git.tocco.ch (in footer)</li>

<li>check available releases on the Gerrit Code Review page</li>

<li>If we are on the newest version nothing has to be done ✅ </li>

<li>If there is a new version <a href="https://www.gerritcodereview.com/">Go to Gerrit Code Review</a> 
and find newest version Rightclick the download link and copy it. The link should look something like:
<i>https://gerrit-releases.storage.googleapis.com/gerrit-3.10.0.war</i></li>

<li>This copied link goes into <b>ansible/roles/gerrit/vars/main.yml</b></li>

<li>We also  need to download the package <b>ourself (locally)</b> and build a hash of it by running
<pre><code class="lang-bash">
 sha256sum gerrit-{version}.war
</code>

</pre></li>
This hash also need to be added to <b>ansible/roles/gerrit/vars/main.yml</b>

<li>Then we change dir to <b>${ANSIBLE_GIT_REPO_ROOT_DIRECTORY}/servers/</b>
and apply the changes via <i>ansible-playbook playbook.yml -l git.tocco.ch -t gerrit</i></li>

</ul>
<h3>Check for firewall updates</h3>
<a href="./Servers.html">OPNsense</a>

<h3>Check Grafana updates</h3>
<a href="https://devops-docs.tocco.ch/updates/grafana.html">Docs-Grafana-Updates</a>

<h3>Install updates via Ansible</h3>
<a href="https://devops-docs.tocco.ch/updates/automated_updates.html">Docs-Ansible-Updates</a>
(Exclude host <b>-l '!backup02.tocco.ch'</b> or multiple with <b>-l '!backup02.tocco.ch:!artifactory01.tocco.ch:!...')

<pre><code class="lang-bash">ansible-playbook playbooks/install_updates/main.yml -l '!tcagent*.tocco.ch:!artifactory01.tocco.ch' -t all,reboot</code></pre>
</b></pre></div>
</div>
</div>
</body></html><!--## Artifactory-Space-Issues #################################################################################################################-->