<!DOCTYPE html>
<html><head>
<title data-folder-path="/Tocco">Tocco-Ansible</title>
<link href=" ../../static/style.css" rel="stylesheet"/>
<link href="../../prism/prism.css" rel="stylesheet"/>
</head>
<body class="body">
<div class="page-folder-header-div">
<h1 class="pagetitle" data-folder-path="Tocco">Tocco-Ansible</h1>
<a href="./../..">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M3 11L12 4L21 11"></path>
<path d="M5 10V20H19V10"></path>
<path d="M10 20V14H14V20"></path>
</svg>
</a>
</div>
<!-- Sidebar -->
<div class="sidbear-enclosure-open" id="sidbear-enclosure-open-Tocco-Ansible">
<button class="sidbear-enclosure-button-open" id="sidbear-enclosure-button-Tocco-Ansible" onclick="toggle_sidebar()" type="button">
<svg fill="white" height="30" viewBox="0 0 100 80" width="30" xmlns="http://www.w3.org/2000/svg">
<rect height="10" width="100"></rect>
<rect height="10" width="100" y="30"></rect>
<rect height="10" width="100" y="60"></rect>
</svg>
</button>
<div class="sidebar-mainbox-open" id="sidebar-mainbox-Tocco-Ansible">
<div class="sidebar-subbox-open" id="sidebar-subbox-1" onclick=" append_foldable_content()">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" x2="12" y1="8" y2="16"></line>
<line x1="8" x2="16" y1="12" y2="12"></line>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-2">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-3">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
</div>
</div>
<script src="../../prism/prism.js"></script>
<script src="../../static/script.js"></script>
<!--## Adjust-Memory-RAM #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Adjust-Memory-RAM">
<h2 class="foldable-title" id="foldable-title-Adjust-Memory-RAM">Adjust-Memory-RAM</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Adjust-Memory-RAM')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Tocco-Ansible','editable-paragraph-Adjust-Memory-RAM', 'foldable-content-penButton-Adjust-Memory-RAM')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Adjust-Memory-RAM" onclick="add_subdiv('editable-paragraph-Adjust-Memory-RAM')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Adjust-Memory-RAM">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Adjust-Memory-RAM" onclick="save_editable_content('Tocco-Ansible','editable-paragraph-Adjust-Memory-RAM', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Adjust-Memory-RAM"><pre><b>Check Memory Stats with:</b>
<pre><code class="lang-bash">
 https://${CUSTOMERNAME}.tocco.ch/status-tocco
tco status ${CUSTOMERNAME} 
tco mem ${CUSTOMERNAME}
</code>
</pre>
<b>Note that the application reports heap-memory
       only which should be ~43% of what you set.
</b>

- The values displayed by https://azek.tocco.ch/status-tocco
are in MB, and need to be divided by <i>factor 0.43</i> (MB-Value /<i>0.43</i> = 3.4 GiB)

<h3>Connection between Stage and Prod Memory </h3>
- Ram of <i>Productive System</i> is coupled with <b>Test System</b>

- If RAM of <i>Productive System</i> has no extra entrance in memory: ...
  The Default value 3.4 GiB gets set.

- The <b>Test System</b> is then a %-Value
  of whatever value is set in <i>Productive System</i>,
  If nothing is explicitly set in <b>Test System</b> -&gt; memory: ...
  (for ex. 2.4GiB if Prod. is default)

- If something is set in <b>Test System</b> -&gt; memory: ...
  Then this value is taken, without any coupling
  to the Prod. System.

- Additional analysis tool: <a href="https://docs.tocco.ch/devops/nice/jmx.html">JMX / visualVM / JConsole </a>

Also check <a href="https://docs.tocco.ch/devops/app_management/ansible_memory.html#index-0">Tocco-Docs : RAM-Setting</a>

<h3>Adjust Memory </h3>
<ul>
<li> Add / update memory setting in config.yml for prod.</li>
<li> Run the playbook against the customer (-l customer_azek) 
( test is adjusted auto. based on prod. because <b>customer_</b>.) </li>
<li> Maybe Commit change and open merge requests.</li>
</ul>
<h3>Create Ticket if OOM</h3>
Memory-Dumps can be found at 
<pre><code class="lang-bash">
 s3cmd ls s3://memory-dumps/nice-${CUSTOMERNAME}/
</code>
</pre>
- check if there is already a ticket (in time period smaller than ~2W) that concerns the same issue.
- Create ticket at <b>Location : Tocco Development / Add Epic / TOCDEV-8234</b>
   <div style="border-style:solid;">
    Memory Dump analysieren für odaszh
    Description
    Bei der produktiven Lösung von ${CUSTOMERNAME} kommt es immer mal wieder zu einem Out-of-Memory (OOM) Fehler.
    Die Lösung hat aktuell 6 GB RAM zurVerfügung.
    Kann sich bitte jemand bei Gelegenheit anschauen, was dort das RAM füllen könnte?
    Den Memory Dump könnt Ihr anhand dieser Anleitung herunterladen (Punkt 3: list dumps Anleitung ):
    Vielen Dank!
   </div>
- Diesem Ticket dann <i>OPS-690</i> als parent zuweisen. Und mit anderem Ticket verlinken.

</pre></div>
</div>
</div>
<!--## Add-New-Domain #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Add-New-Domain">
<h2 class="foldable-title" id="foldable-title-Add-New-Domain">Add-New-Domain</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Add-New-Domain')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Tocco-Ansible','editable-paragraph-Add-New-Domain', 'foldable-content-penButton-Add-New-Domain')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Add-New-Domain" onclick="add_subdiv('editable-paragraph-Add-New-Domain')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Add-New-Domain">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Add-New-Domain" onclick="save_editable_content('Tocco-Ansible','editable-paragraph-Add-New-Domain', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Add-New-Domain"><h1>TITLE IPSUM</h1>
<!--## Single-Domain #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Single-Domain">
<h2 class="foldable-title" id="foldable-title-Single-Domain">Single-Domain</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Single-Domain')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Tocco-Ansible','editable-paragraph-Single-Domain', 'foldable-content-penButton-Single-Domain')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Single-Domain">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Single-Domain" onclick="save_editable_content('Tocco-Ansible','editable-paragraph-Single-Domain', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Single-Domain"><pre>- Customers have a new domain, that needs to be connected to the installation.


- First we need to check the NS


- The DNS Zone of the Domain needs to somehow point towards Tocco.
  (fasc: "das isch nur denn de fall wenn d website ih euisem tocco redaktionssystem drin isch" )


- Third we need to make Two changes to the Ansible-Config.
  By searching the installation and then add the domain
  once -&gt; with <i>www.</i>
  once -&gt; only <i>domain.ch</i>
  <b>Missing Ansible-Config entrance is also noticeable if the https: call displays a cert-error.</b>


- One last thing is that the domain needs to be set in some Tocco-Installation internal, but this is usually done by BS


- If success, the domain should be accessible via http: on browser without a cert error.
</pre></div>
</div>
</div>
<!--## Widget-Testdomain-Mida #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Widget-Testdomain-Mida">
<h2 class="foldable-title" id="foldable-title-Widget-Testdomain-Mida">Widget-Testdomain-Mida</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Widget-Testdomain-Mida')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Tocco-Ansible','editable-paragraph-Widget-Testdomain-Mida', 'foldable-content-penButton-Widget-Testdomain-Mida')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Widget-Testdomain-Mida">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Widget-Testdomain-Mida" onclick="save_editable_content('Tocco-Ansible','editable-paragraph-Widget-Testdomain-Mida', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Widget-Testdomain-Mida"><pre>- Mida wants so test widgets on his own server sometimes (deex.cch)


- Therefore we create a new entrance underneath <i>routes:</i>
   the corresponding test system and we add: <b>tocco.toc-example.deex.ch</b>


- Then mida has to create a CNAME at deex.ch s DNS-Zone


- If we get some kind of Error saying:
<b>"...Access-Control-Allow-Origin' header is present on the
requested resource. If an opaque response serves your needs, set the
request's mode to 'no-cors' to fetch the resource with CORS disabled"</b>


- We also need to add the domain with <b>https://tocco.toc-example.deex.ch</b>
underneath: <i>nice2.web.allowedRequestOrigins:</i> 
(not with <b>env:</b> anymore. See also: <a href="">this</a>


<div style="border-style:solid; border-color:yellow">
   Sometimes it can be a problem, that some entrances are cashed, and because of that the
   DNS-Changes are not present yet. Cashed at network / DNS-Provider.


   This is especially then suspicious, when we do a 
   dig @ the Nameserver of the Domain-Hoster itselfe and get a different result.


   dig @ns1.cyon.ch $DOMAIN vs. dig $DOMAIN 


   Then we just have to wait and try again later.

</div>


</pre></div>
</div>
</div>

<!--## Domain-With-Wordpress #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Domain-With-Wordpress">
<h2 class="foldable-title" id="foldable-title-Domain-With-Wordpress">Domain-With-Wordpress</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Domain-With-Wordpress')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Tocco-Ansible','editable-paragraph-Domain-With-Wordpress', 'foldable-content-penButton-Domain-With-Wordpress')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Domain-With-Wordpress">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Domain-With-Wordpress" onclick="save_editable_content('Tocco-Ansible','editable-paragraph-Domain-With-Wordpress', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Domain-With-Wordpress"><html><head></head><body><pre>- Basically the same as @mida specialexample.
- We need to create two entrances into routes:
     Single Domain name
     Ingress = False entrance


- For Example:
<pre><code class="lang-bash">
                              routes:
                                    web.cwbtest-temp.tocco.ch:
                                         create_ingress: false            # WordPress pages using our widgets
                                    tocco.web.cwbtest-temp.tocco.ch:'
</code>
</pre>
or
<pre><code class="lang-bash">
                              routes:
                                    test-my.swissengineering.ch:
                                          create_ingress: false          # WordPress pages using our widgets
                                    tocco.test-my.swissengineering.ch:
</code>
</pre>
<b>Why is this needed after all ?</b>
<div style="border-style:solid;">


   Without create_ingress: false a new Cert. would be created via Openshift.
   LetsEncrypt always needs a location where a special file is present
   With certain content. Because the route leads to a Server
   That has nothing to do with Openshift, this would fail.


</div>
</pre></body></html></div>
</div>
</div>
</div>
</div>
</div>
</body></html>