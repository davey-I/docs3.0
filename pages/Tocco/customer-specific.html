<!DOCTYPE html>
<html><head>
<title data-folder-path="/Tocco">customer-specific</title>
<link href=" ../../static/style.css" rel="stylesheet"/>
<link href="../../prism/prism.css" rel="stylesheet"/>
</head>
<body class="body">
<div class="page-folder-header-div">
<h1 class="pagetitle" data-folder-path="Tocco">customer-specific</h1>
<a href="./../..">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M3 11L12 4L21 11"></path>
<path d="M5 10V20H19V10"></path>
<path d="M10 20V14H14V20"></path>
</svg>
</a>
</div>
<!-- Sidebar -->
<div class="sidbear-enclosure-open" id="sidbear-enclosure-open-customer-specific">
<button class="sidbear-enclosure-button-open" id="sidbear-enclosure-button-customer-specific" onclick="toggle_sidebar()" type="button">
<svg fill="white" height="30" viewBox="0 0 100 80" width="30" xmlns="http://www.w3.org/2000/svg">
<rect height="10" width="100"></rect>
<rect height="10" width="100" y="30"></rect>
<rect height="10" width="100" y="60"></rect>
</svg>
</button>
<div class="sidebar-mainbox-open" id="sidebar-mainbox-customer-specific">
<div class="sidebar-subbox-open" id="sidebar-subbox-1" onclick=" append_foldable_content()">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" x2="12" y1="8" y2="16"></line>
<line x1="8" x2="16" y1="12" y2="12"></line>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-2">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-3">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
</div>
</div>
<script src="../../prism/prism.js"></script>
<script src="../../static/script.js"></script>
<!--## iffp #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-iffp">
<h2 class="foldable-title" id="foldable-title-iffp">iffp</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('iffp')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('customer-specific','editable-paragraph-iffp', 'foldable-content-penButton-iffp')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-iffp" onclick="add_subdiv('editable-paragraph-iffp')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-iffp">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-iffp" onclick="save_editable_content('customer-specific','editable-paragraph-iffp', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-iffp"><h1>iffp aka. IAF</h1>
<div class="foldable-container" id="foldcontainer-iffp-exam">
<h2 class="foldable-title" id="foldable-title-iffp-exam">iffp-exam</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('iffp-exam')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('customer-specific','editable-paragraph-iffp-exam', 'foldable-content-penButton-iffp-exam')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-iffp-exam">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-iffp-exam" onclick="save_editable_content('customer-specific','editable-paragraph-iffp-exam', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-iffp-exam"><pre>Für iffp mussten schon einigemal die IP-Zugriffe während
Prüfungen herausgesucht werden.

Pege hat diese in <i>BS-12585</i> zusammengefasst.
Am sichersten ist es wohl, einen DB-Dump zu erstellen
und dann lokal eine neue DB zu erstellen.

Dort können dann das <b>DB-File + db_history</b> file in die
erstellte DB gemerged werden, so dass beide daten drin sind.

- Als erstes müssen db-dump und history-dump geholt 
 werden und und aus diese beide in <b>eine</b> DB restored werden:

<b>Create one new DB</b>
<!--Prism bash pretyfier code example-->
    <pre>        <code class="lang-sql">
CREATE DATABASE ${DB_NAME} WITH OWNER ${DB_USER};
        </code>
</pre>
<br/>
<b>Restore both dump files into one DB</b>:
<!--Prism bash pretyfier code example-->
    <pre>        <code class="lang-bash">
pg_restore -j 4 --role ${DB_USER} --no-owner --no-acl -d ${DB_NAME} ${DUMP_FILE_OR_DIRECTORY}
        </code>
</pre>
- Auf postgres user switchen <b>sudo -i -u postgres</b>


- Im  postgres user  ~ Verzeichnis ein <b>output.csv</b> erstellen und <b>chmod 777 output.csv</b>


- Abfrage für einen <b>spezifischen User</b>:

<div class="frame">Adjust the <b>Username</b> and the <b>Time</b> first ! </div>
<pre><code class="lang-sql">
COPY (SELECT
    h.username AS user,
    h.insertion_time AS time,
    h.ip_address AS "IP",
    h.entity_key AS "history ID",
    h.operation,
    si.label AS exam
FROM
    nice_history AS h
    LEFT OUTER JOIN nice_survey_question_answer AS sqa ON h.entity_key::bigint = sqa.pk
    LEFT OUTER JOIN nice_survey_user_intrusion AS sui ON sqa.fk_user_intrusion = sui.pk
    LEFT OUTER JOIN nice_survey_intrusion AS si ON sui.fk_intrusion = si.pk
WHERE
    h.insertion_time BETWEEN '2024-09-10' AND '2024-09-11'
    AND h.entity_model = 'Survey_question_answer'
    AND h.username = '${USERMANE}@${WHATEVER}.com'
) TO '~/output2.csv' CSV HEADER;
</code>
</pre>


- Generelle Abfrage über alle User:

<pre><code class="lang-sql">
    \copy (
    with history_selected as (
        select
            h.username,
            h.ip_address,
            h.insertion_time,
            si.pk as exam_pk,
            si.label as exam_label
        from nice_history as h
             left outer join nice_survey_question_answer as sqa on h.entity_key::bigint = sqa.pk
             left outer join nice_survey_user_intrusion as sui on sqa.fk_user_intrusion = sui.pk
             left outer join nice_survey_intrusion as si on sui.fk_intrusion = si.pk
        where
            insertion_time between '2024-11-04' and '2024-11-07'
               and entity_model = 'Survey_question_answer'
    ) select
        s.username as user,
        s.ip_address as "IP",
        (select min("inner".insertion_time) from history_selected as "inner" where "inner".username = s.username and "inner".ip_address = s.ip_address and (("inner".exam_pk is null and s.exam_pk is null) or ("inner".exam_pk = s.exam_pk))) as "first use of IP",
        (select max("inner".insertion_time) from history_selected as "inner" where "inner".username = s.username and "inner".ip_address = s.ip_address and (("inner".exam_pk is null and s.exam_pk is null) or ("inner".exam_pk = s.exam_pk))) as "last use of IP",
        case when s.exam_label is not null then s.exam_label else '' end as exam
    from
        history_selected as s
    group by s.username, s.ip_address, s.exam_pk, s.exam_label
    order by 1, 2
) TO '~/output.csv' WITH CSV HEADER;
                      
</code>
</pre>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<!--## akad #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-akad">
<h2 class="foldable-title" id="foldable-title-akad">akad</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('akad')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('customer-specific','editable-paragraph-akad', 'foldable-content-penButton-akad')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-akad" onclick="add_subdiv('editable-paragraph-akad')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-akad">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-akad" onclick="save_editable_content('customer-specific','editable-paragraph-akad', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-akad"><h1>AKAD</h1>

<div class="foldable-container" id="foldcontainer-Aufbereitung-Datenträgers-Escrow">
<h2 class="foldable-title" id="foldable-title-Aufbereitung-Datenträgers-Escrow">Aufbereitung-Datenträgers-Escrow</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Aufbereitung-Datenträgers-Escrow')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('customer-specific','editable-paragraph-Aufbereitung-Datenträgers-Escrow', 'foldable-content-penButton-Aufbereitung-Datenträgers-Escrow')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Aufbereitung-Datenträgers-Escrow">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Aufbereitung-Datenträgers-Escrow" onclick="save_editable_content('customer-specific','editable-paragraph-Aufbereitung-Datenträgers-Escrow', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Aufbereitung-Datenträgers-Escrow"><html><head></head><body><pre>Alle x-jahre, verlangt Akad Daten, um das ERP-Selber zu betreiben
falls wir von heute auf morgen konkurs gehen würden (lol).

Das ganze ist eher eine Formalität, da dies ziemlich sicher eh nicht
klappen würde. Dennoch stellen wir Ihnen die Daten auf einem 
USB-Stick zusammen.

Folgendes wir dabei inkludiert:

<img src="../../images/escrow_inhalt.png"/>


</pre></body></html></div>
</div>
</div>
</div>
</div>
</div>
</body></html><!--## Aufbereitung-Datenträgers-Escrow #################################################################################################################--><!--## iffp-exam #################################################################################################################-->