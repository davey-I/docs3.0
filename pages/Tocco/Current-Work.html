<!DOCTYPE html>
<html><head>
<title data-folder-path="/Tocco">Current-Work</title>
<link href=" ../../static/style.css" rel="stylesheet"/>
<link href="../../prism/prism.css" rel="stylesheet"/>
</head>
<body class="body">
<div class="page-folder-header-div">
<h1 class="pagetitle" data-folder-path="Tocco">Current-Work</h1>
<a href="./../..">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M3 11L12 4L21 11"></path>
<path d="M5 10V20H19V10"></path>
<path d="M10 20V14H14V20"></path>
</svg>
</a>
</div>
<!-- Sidebar -->
<div class="sidbear-enclosure-open" id="sidbear-enclosure-open-Current-Work">
<button class="sidbear-enclosure-button-open" id="sidbear-enclosure-button-Current-Work" onclick="toggle_sidebar()" type="button">
<svg fill="white" height="30" viewBox="0 0 100 80" width="30" xmlns="http://www.w3.org/2000/svg">
<rect height="10" width="100"></rect>
<rect height="10" width="100" y="30"></rect>
<rect height="10" width="100" y="60"></rect>
</svg>
</button>
<div class="sidebar-mainbox-open" id="sidebar-mainbox-Current-Work">
<div class="sidebar-subbox-open" id="sidebar-subbox-1" onclick=" append_foldable_content()">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" x2="12" y1="8" y2="16"></line>
<line x1="8" x2="16" y1="12" y2="12"></line>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-2">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-3">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
</div>
</div>
<script src="../../prism/prism.js"></script>
<script src="../../static/script.js"></script>
<!--## WAF #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-WAF">
<h2 class="foldable-title" id="foldable-title-WAF">WAF</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('WAF')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Current-Work','editable-paragraph-WAF', 'foldable-content-penButton-WAF')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-WAF" onclick="add_subdiv('editable-paragraph-WAF')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-WAF">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-WAF" onclick="save_editable_content('Current-Work','editable-paragraph-WAF', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-WAF"><h1>Different Project Infos etc.</h1>
<div class="foldable-container" id="foldcontainer-Apache-Approach">
<h2 class="foldable-title" id="foldable-title-Apache-Approach">Apache-Approach</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Apache-Approach')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Current-Work','editable-paragraph-Apache-Approach', 'foldable-content-penButton-Apache-Approach')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Apache-Approach">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Apache-Approach" onclick="save_editable_content('Current-Work','editable-paragraph-Apache-Approach', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Apache-Approach"><pre><h3>Webserver-WAF Testing</h3>
Create new VM  and set up a fresh web server reverse proxying
traffic to <b>master.tocco.ch.</b>



It's probably easier to set this up locally and or in a
VM just adding an additional proxy in front. Not sure if <i>Nginx</i>
or <b>Apache</b> is the better choice. If mod_security is to be used
Apache2 may have better support.



Setup Apache2 Webserver on debian-vm


- Apache webserver on debian12-vm setup


- Creating portforwarding Host - VM 8080:80


- Setup Postgres(15.3) on VM


- enabled following on apache2
  sudo a2enmod proxy
  sudo a2enmod proxy_http
  sudo a2enmod ssl
  sudo a2enmod headers


- Created a vhost: /etc/apache2/sites-available/reverse-proxy.conf
  
   <b>Mit Fasc</b>: 
       - ProxyPreserveHost: ...musste auf off gestellt werden


       - generell musste das ganze auf https bzw. <virtualhost *:443=""> umgestellt werden
          was natürlich auch ein Zertifikat benötigte (Self-Signed, einfach für schnell )


- Man kann jetzt über die in /etc/hosts definierte wegleitung über proxy auf test313 kommen


- configure webserver as reverse proxy.. basically this setup 
  https://www.linuxbabe.com/security/modsecurity-apache-debian-ubuntu


<h3>WAF / Nice2 Problems </h3>


- Für das Setup müssen zimlich sicher Rules aus dem Modsecurity package gefunden und deaktiviert werden


- Modsecurity kann für bestimmte IPs auch komplett deaktiviert werden ( IP Whitelisting )



<h3>Things that occurd after the SecRuleEngine DetectionOnly was turned to On</h3>


-  ReverseAjax.dwr / xhr type Problems ending in 403 Forbidden
   - RequestURL:  https://myproxy.local:4443/nice2/dwr/call/plainpoll/ReverseAjax.dwr
   - If any other Endpoint except " / " gets visited this appears after a few seconds
</virtualhost></pre></div>
</div>
</div>


<!--## Apache-Approach-Part2 #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Apache-Approach-Part2">
<h2 class="foldable-title" id="foldable-title-Apache-Approach-Part2">Apache-Approach-Part2</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Apache-Approach-Part2')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Current-Work','editable-paragraph-Apache-Approach-Part2', 'foldable-content-penButton-Apache-Approach-Part2')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Apache-Approach-Part2">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Apache-Approach-Part2" onclick="save_editable_content('Current-Work','editable-paragraph-Apache-Approach-Part2', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Apache-Approach-Part2"><html><head></head><body><pre><h2 class="highlighteryellow">Simulate Gitlabrunner Env.</h2>

<span class="highlighteryellow">Basically we do the same as mentioned in <strong>Nginx-Approach-Part2</strong>
to get the current setup, with apache2 instead of nginx.
</span>
- clone the repo to our local machine

- pull the image from gitlab-registry to local machine
  and mount the repo into the container + set the working dir.
  
- After that we have pretty much the same situation that
  gets created on the Gitlab-Runner. Of course the <i>gitlab-ci.yml</i>
  automation is not working here. Since its just a small amount of steps
  that get performed within the gitlab-ci file, we can probably just execute
  them manually by hand or write a small bash script including the tasks.

<h2 class="highlighteryellow">Comparison Nginx - Apache2 directories inside Pod</h2>
<div>
  <h4>nginx to Apache2 File Mapping</h4>
  <table border="1" cellpadding="8" cellspacing="0"><tbody><tr><th>nginx</th><th>Apache2</th></tr><tr><td>/etc/nginx/nginx.conf</td><td>/etc/apache2/apache2.conf</td></tr><tr><td>/etc/nginx/conf.d/</td><td>/etc/apache2/sites-available/<br/>/etc/apache2/conf-available/</td></tr><tr><td>/etc/nginx/mime.types</td><td>/etc/apache2/mime.types (via mod_mime)</td></tr><tr><td>/etc/nginx/modules/</td><td>/etc/apache2/mods-available/<br/>/etc/apache2/mods-enabled/</td></tr><tr><td>/etc/nginx/fastcgi_params</td><td>/etc/apache2/mods-available/fcgid.conf<br/>(or mod_proxy_fcgi configuration)</td></tr><tr><td>/etc/nginx/proxy.include</td><td>/etc/apache2/mods-available/proxy.conf<br/>(custom proxy settings)</td></tr><tr><td>/etc/nginx/scgi_params</td><td>/etc/apache2/mods-available/proxy_scgi.conf</td></tr><tr><td>/etc/nginx/uwsgi_params</td><td>/etc/apache2/mods-available/proxy_uwsgi.conf</td></tr><tr><td>/etc/nginx/headers.include</td><td>Custom .conf in /etc/apache2/conf-available/</td></tr><tr><td>/etc/nginx/admin_csp_headers.include</td><td>Custom .conf in /etc/apache2/conf-available/</td></tr></tbody></table>
  <h4>Typical Apache2 Directory Structure</h4>
  <pre>/etc/apache2/
├── apache2.conf              # Main config (like nginx.conf)
├── ports.conf                # Listen directives
├── mods-available/           # Available modules (like nginx modules/)
├── mods-enabled/            # Enabled modules (symlinks)
├── conf-available/          # Additional configs (like nginx conf.d/)
├── conf-enabled/            # Enabled configs (symlinks)
├── sites-available/         # Virtual host configs
├── sites-enabled/           # Enabled sites (symlinks)
└── envvars                  # Environment variables
  </pre>
  <h4>Key Differences</h4>
  <ul>
    <li><strong>nginx's .include files</strong> → In Apache2, you'd create custom .conf files in conf-available/ and enable them with a2enconf filename</li>
    <li><strong>nginx's conf.d/</strong> → Apache2 uses both sites-available/ (for vhosts) and conf-available/ (for other configs)</li>
    <li><strong>nginx modules</strong> → Apache2 modules are enabled/disabled with a2enmod/a2dismod commands</li>
  </ul>
</div>
<h2 class="highlighteryellow">Adjust Existing Nginx config to Apache2</h2>
Looking at the existing Nginx-Repo on Gitlab, there are
multiple points, that need to be adjusted from <i>Nginx</i> to <b>Apache2</b>

<h3>nginx.conf.template</h3>
- <b>error_log</b> directory = <i>ErrorLog ${APACHE_LOG_DIR}/error.log</i>
- <b>warn</b> as log level = <i>LogLevel warn</i>
- <b>pid</b> = <i>PidFile ${APACHE_PID_FILE}</i> # This needs to be set in /etc/apache2/envvars
- <b>events{worker_connections 4096;}</b>
   <i>&lt;IfModule mpm_event_module&gt;
    ServerLimit             4
    StartServers            4
    MinSpareThreads         25
    MaxSpareThreads         75
    ThreadLimit             64
    ThreadsPerChild         25
    MaxRequestWorkers       4096
    MaxConnectionsPerChild  0
&lt;/IfModule&gt;</i>


<h3>nice2.conf.template</h3>

<h3>.gitlab-ci.yml</h3>

<h3>Dockerfile</h3>

<h3>README</h3>

<h3> all .py files</h3>

</pre></body></html></div>
</div>
</div>


<!--## Nginx-Approach #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Nginx-Approach">
<h2 class="foldable-title" id="foldable-title-Nginx-Approach">Nginx-Approach</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Nginx-Approach')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Current-Work','editable-paragraph-Nginx-Approach', 'foldable-content-penButton-Nginx-Approach')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Nginx-Approach">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Nginx-Approach" onclick="save_editable_content('Current-Work','editable-paragraph-Nginx-Approach', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Nginx-Approach"><pre>- since the complete tocco-setup is already based on Nginx-Webserver
 its maybe easier to just use the mod-security adapter for that


- Next steps assume that a running VM on Virtualbox is available
 and reachable vis SSH ( ports forwarding already done )


<h3>Setup basic Nginx Webserver</h3>


<pre><code class="lang-bash">
sudo apt install nginx -y


# next stepd might be optional...
sudo ufw allow 80/tcp
sudo ufw reload


</code>
</pre>


- Create portforwarding in Virtualbox
 
 Host 8080 - Guest 80 (should work directly..)
 Host 4443 - Guest 443 ( won't work directly...)


<h3>Make https work</h3>


- For https to work, we need a certificate. We could now:


   - Creat a verified cert the <b>browser trusts</b>
   - Create a self-signed cert, the <b>browser won't trust</b>


- No matter which option we choose, the <b>traffic is encrypted</b>
 and we can <b>use https</b> to connect to our VM-Webserver.


 However, if we choose the <b>self-signed option</b>, the browser will always
 show a warning, because it <b>won't trust</b> the certificate, because its <b>origin</b>
 does not lead to a <b>trusted cert authority</b>.


<h4>Summary</h4>
<div class="frame">
<b>Benefits of a self-signed certificate</b>


✅ Encryption: traffic is still fully encrypted — no one can snoop passwords or
 tokens between your browser and VM.


✅ CORS compatibility: your app requires HTTPS origin (https://myproxy.local:4443).
A self-signed cert satisfies that requirement (the scheme is https://).


✅ Dev/Testing: good enough for local or test environments where you don’t
want to request a real CA cert.


❌ Downside: You’ll always see “Not Trusted” unless you import the
cert into your OS/browser trust store.


❌ MITM attacks can <b>not</b> be prevented, unless clients are configured to
explicitly trust the self-signed cert’s fingerprint.
</div>


<h3> Where are these Certs located, where does Nginx search ? </h3>


- Both <b>Apache2 and Nginx</b> usually look for certificates in a few standard directories:


  - /etc/ssl/certs/


  - /etc/ssl/private/


  - /etc/nginx/ssl/ (sometimes manually created by admins)


  - <b>/etc/nginx/certs/</b>


  - /etc/apache2/ssl/


  - /etc/apache2/sites-available/ (or /etc/apache2/sites-enabled/) → check configs for paths


  - /usr/local/share/ca-certificates/ (for trusted custom CA roots)


<h3> Create self-signed cert </h3>


1️⃣ <h4>Create a directory to store your certs</h4>


<pre><code class="lang-bash">


sudo mkdir -p /etc/nginx/ssl
sudo chmod 700 /etc/nginx/ssl


</code>
</pre>


2️⃣ <h4>Generate a private key and self-signed certificate</h4>
For ex: a certificate valid for 1 year for <i>myproxy.local</i>
<pre><code class="lang-bash">


sudo openssl req -x509 -nodes -days 365 \
  -newkey rsa:2048 \
  -keyout /etc/nginx/ssl/myproxy.local.key \
  -out /etc/nginx/ssl/myproxy.local.crt \
  -subj "/CN=myproxy.local"


</code>
</pre>
<b>Explanation</b>


-x509 → generate a self-signed cert, not a CSR


-nodes → no passphrase on private key (so Nginx can read it automatically)


-days 365 → valid for 1 year


-newkey rsa:2048 → generate a 2048-bit RSA key


-subj "/CN=myproxy.local" → sets the certificate’s Common Name (hostname)


4️⃣ <h4>Configure Nginx to use it</h4>
Add a server block in <i>/etc/nginx/sites-available/default</i>
(or your own config):
<pre><code class="lang-bash">
server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name myproxy.local;
    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;


    location / {
         # First attempt to serve request as file, then
 # as directory, then fall back to displaying a 404.
 try_files $uri $uri/ =404;
    }


    ssl_certificate     /etc/nginx/ssl/myproxy.local.crt;
    ssl_certificate_key /etc/nginx/ssl/myproxy.local.key;
}


server {
    listen 80;
    listen [::]:80;
    server_name myproxy.local;
    return 301 https://$host$request_uri;
}


</code>
</pre>


- Check config validity with <b>sudo nginx -t</b>


5️⃣ <h4>Restart Nginx</h4>
Restart and then follow this guide: <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu#step-2-configuring-nginx-to-use-ssl">Configure-Nginx</a>
-Maybe also test if encryption works, see <b>Part2</b> (below) for that



<h3>Adjust hosts file on Host machine</h3>
At the end, we need to create a entrance in <i>/etc/hosts</i>
on the Host machine (not the VM ! ) 
For the example config from above we would add
<b> 127.0.0.1        myproxy.local</b>
After this we should be able to just enter
<i>https://myproxy.local:${PORT}</i>
Where ${PORT} is the Port from Virtualbox
NAT Portforwarding...
</pre></div>
</div>
</div>
<!--## Nginx-Approach-Part2 #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Nginx-Approach-Part2">
<h2 class="foldable-title" id="foldable-title-Nginx-Approach-Part2">Nginx-Approach-Part2</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Nginx-Approach-Part2')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Current-Work','editable-paragraph-Nginx-Approach-Part2', 'foldable-content-penButton-Nginx-Approach-Part2')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Nginx-Approach-Part2">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Nginx-Approach-Part2" onclick="save_editable_content('Current-Work','editable-paragraph-Nginx-Approach-Part2', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Nginx-Approach-Part2"><pre>At this point, it should be possible to connect to the Nginx-Webserver, that
is setup on the VM, via <i>https</i>. But the Browser will still flag this as
a <b> Not Secure </b> connection.

<h3>How to manually identify if Stuff gets really encrypted ?</h3>
To identify this we can use a combination of <b>curl</b> and <b>tcpdump</b>

<h4>Test on the VM</h4>
- <b>curl -v</b> the Website, which should show the content decrypted. Important
is that we should see something like :

* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
<b>More infos at: </b><a href="../Security/Security-SSL-Certificates.html">TLS-Section</a>

This means the
<pre><code class="lang-bash">
# Change to whatever IP/Port expected
curl -vk https://127.0.0.1:443/
</code>
</pre>

- Capture packages on the VM. This should give encrypted output.
so to say we look what comes out the "pipe" on the arrival-side. Which
at this point is of course still encrypted.
<pre><code class="lang-bash">
#Change to whatever port and interface
sudo tcpdump -i enp0s3 -nn -s 0 -A port 443
</code>
</pre>
<h4>Test on the Host machine</h4>
On the <b>Host</b> we can basically do the same
aso above on the <b>Guest-VM</b> and we should also
get similar outputs, since we just send this from a different
host to Nginx ( not on the Guest but now on the Host )

<pre><code class="lang-bash">
placeholder
</code>
</pre>
<h2 class="highlighteryellow">Simulate gitlabrunner Env. for local testing</h2>

<b>First just using the Nginx-Repo and Image</b>

- Pull the image that is used on the gitlabrunner:
<pre><code class="lang-bash">registry.gitlab.com/toccoag/base-images/debian:stable-podman</code></pre>

- Clone the Repo:
<pre><code class="lang-bash">git clone git@gitlab.com:toccoag/openshift-nginx.git</code></pre>

- Run the container and mount the repo into it, so that all files etc. are
available for the podman build that is performed afterwards:
<pre><code class="lang-bash">
podman run -it --rm \
  # --privileged \ # not sure about that one
  -v $(pwd):/var/lib/containers \
  -w /var/lib/containers \
  registry.gitlab.com/toccoag/base-images/debian:stable-podman \
  /bin/bash
</code></pre>
<div class="frame">It's <b>important</b> that we mount to <i>/var/lib/containers</i>
otherwise we probably get an fuse-overlayfs error later
see: <a href="https://github.com/containers/buildah/issues/3666#issuecomment-989295318">This post</a></div>
after this we should be in the container.

- Performe the steps from <i>gitlab-ci.yml</i> file manually
Output from running the integration tests:
<pre><code class="lang-bash">
root@3fe2a4565f6e:/var/lib/containers# ./tests/integration_tests.py 
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /200 HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /cache HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /cache HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /cache HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "HEAD /cache HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /method HTTP/1.1" 200 -
{'Server': 'nginx', 'Date': 'Fri, 10 Oct 2025 10:43:12 GMT', 'Transfer-Encoding': 'chunked', 'Connection': 'keep-alive', 'X-Method-Received': 'GET', 'Some-Always-Header': 'some always "value"', 'Some-Header': 'some "value"', 'X-Cache': 'MISS', 'X-AppServer-Status': '200'}
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "HEAD /method HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /200 HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /404 HTTP/1.1" 404 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:43:12] "GET /500 HTTP/1.1" 500 -
Testing 4 minute timeout. Be patient.
::ffff:127.0.0.1 - - [10/Oct/2025 10:47:12] "GET /time=240 HTTP/1.1" 200 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:47:12] "GET /websocket HTTP/1.1" 101 -
::ffff:127.0.0.1 - - [10/Oct/2025 10:47:12] "GET /no-websocket HTTP/1.1" 200 -
</code></pre>

</pre></div>
</div>
</div>

</div>
</div>
</div>
</body></html><!--## Apache-Approach #################################################################################################################-->