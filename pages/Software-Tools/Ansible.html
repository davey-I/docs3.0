<!DOCTYPE html>
<html><head>
<title data-folder-path="/Software-Tools">Ansible</title>
<link href=" ../../static/style.css" rel="stylesheet"/>
<link href="../../prism/prism.css" rel="stylesheet"/>
</head>
<body class="body">
<div class="page-folder-header-div">
<h1 class="pagetitle" data-folder-path="Software-Tools">Ansible</h1>
<a href="./../..">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M3 11L12 4L21 11"></path>
<path d="M5 10V20H19V10"></path>
<path d="M10 20V14H14V20"></path>
</svg>
</a>
</div>
<!-- Sidebar -->
<div class="sidbear-enclosure-open" id="sidbear-enclosure-open-Ansible">
<button class="sidbear-enclosure-button-open" id="sidbear-enclosure-button-Ansible" onclick="toggle_sidebar()" type="button">
<svg fill="white" height="30" viewBox="0 0 100 80" width="30" xmlns="http://www.w3.org/2000/svg">
<rect height="10" width="100"></rect>
<rect height="10" width="100" y="30"></rect>
<rect height="10" width="100" y="60"></rect>
</svg>
</button>
<div class="sidebar-mainbox-open" id="sidebar-mainbox-Ansible">
<div class="sidebar-subbox-open" id="sidebar-subbox-1" onclick=" append_foldable_content()">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" x2="12" y1="8" y2="16"></line>
<line x1="8" x2="16" y1="12" y2="12"></line>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-2">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-3">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
</div>
</div>
<script src="../../prism/prism.js"></script>
<script src="../../static/script.js"></script>
<!--## Software-Tools-Ansible-Playbook #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Software-Tools-Ansible-Playbook">
<h2 class="foldable-title" id="foldable-title-Software-Tools-Ansible-Playbook">Software-Tools-Ansible-Playbook</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Software-Tools-Ansible-Playbook')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Ansible','editable-paragraph-Software-Tools-Ansible-Playbook', 'foldable-content-penButton-Software-Tools-Ansible-Playbook')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Software-Tools-Ansible-Playbook" onclick="add_subdiv('editable-paragraph-Software-Tools-Ansible-Playbook')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Software-Tools-Ansible-Playbook">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Software-Tools-Ansible-Playbook" onclick="save_editable_content('Ansible','editable-paragraph-Software-Tools-Ansible-Playbook', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Software-Tools-Ansible-Playbook"><h1>Various things about running Ansible-Playbooks </h1>
<!--## Software-Tools-Ansible-Playbook-Not-Declarative #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Software-Tools-Ansible-Playbook-Not-Declarative">
<h2 class="foldable-title" id="foldable-title-Software-Tools-Ansible-Playbook-Not-Declarative">Software-Tools-Ansible-Playbook-Not-Declarative</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Software-Tools-Ansible-Playbook-Not-Declarative')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Ansible','editable-paragraph-Software-Tools-Ansible-Playbook-Not-Declarative', 'foldable-content-penButton-Software-Tools-Ansible-Playbook-Not-Declarative')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Software-Tools-Ansible-Playbook-Not-Declarative">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Software-Tools-Ansible-Playbook-Not-Declarative" onclick="save_editable_content('Ansible','editable-paragraph-Software-Tools-Ansible-Playbook-Not-Declarative', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Software-Tools-Ansible-Playbook-Not-Declarative"><h3>⚠️ Ansible is not declarative like Terraform — it won’t clean up what's no longer declared.<br/>
It just doesn’t manage that part anymore.</h3><br/>
<b>When you:</b>
<ul>
<li>Delete a task from monitoring2.yml (e.g., one that configures mail alerts),</li><br/>
<li>Run your playbook again,</li><br/>
<li>Ansible does not "undo" what the deleted task previously did. Instead, It sees the remaining tasks, runs them,</li><br/>
<li>The removed task is simply not there anymore, so nothing triggers its reversal.</li><br/>
</ul>
<h3>Example monitoring2 - AlertmanagerConfig</h3>
<!--Prism bash pretyfier code example-->
    <pre>        <code class="lang-yaml">
           - name: create alertmanager config
-    k8s:
-      host: '{{ k8s_endpoint }}'
-      api_key: '{{ k8s_auth_token }}'
-      namespace: '{{ k8s_project }}'
-      resource_definition:
-        apiVersion: monitoring.coreos.com/v1beta1
-        kind: AlertmanagerConfig
-        metadata:
-          name: default
-        spec:
-          receivers:
-          - na.....
-          route:
-            groupBy: [ alertname, instance ]
-            receiver: default
-    when: state == 'present'
        </code>
    </pre>
<li> If we wan't to delete this, we can't just delete the whole thing and re-run the Playbook<br/>
in this case we can simply just change the <b> state</b> to <b> =='absent'</b> and re-run Playbook
</li></div>
</div>
</div>
<!--## Software-Toolc-Ansible-Playbook-Checkmode #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Software-Toolc-Ansible-Playbook-Checkmode">
<h2 class="foldable-title" id="foldable-title-Software-Toolc-Ansible-Playbook-Checkmode">Software-Toolc-Ansible-Playbook-Checkmode</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Software-Toolc-Ansible-Playbook-Checkmode')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Ansible','editable-paragraph-Software-Toolc-Ansible-Playbook-Checkmode', 'foldable-content-penButton-Software-Toolc-Ansible-Playbook-Checkmode')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Software-Toolc-Ansible-Playbook-Checkmode">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Software-Toolc-Ansible-Playbook-Checkmode" onclick="save_editable_content('Ansible','editable-paragraph-Software-Toolc-Ansible-Playbook-Checkmode', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Software-Toolc-Ansible-Playbook-Checkmode"><h1>Ansible checkmode and --check stuff</h1>
<li>In Ansible there is a <b>--check</b> mode, that allows to check what a change will do without applying any write-changes.</li><br/>
<li> Modules <b>that support check mode</b> report the changes they would have made.</li><br/>
<li> Modules that <b>do not</b> support check mode <b>report nothing</b> and <b>do nothing</b>.</li><br/>
<li> You can combine check mode and <b>diff mode</b> for detailed validation of your playbook or role..</li><br/>
<li> It is possible to run tasks in check mode <b>always</b>, or <b>never</b>, regardless of whether you run the<br/>
        playbook <b>with or without --check</b>
<ul>
<li>To force a task to run in check mode, even when the playbook is called without <b>--check</b>, set <b>check_mode: true</b>.</li>
<li> To force a task to run in normal mode and make changes to the system, even when the playbook is called with <b>--check</b>, set <b>check_mode: false</b>. </li>
</ul>
</li><br/>
<li> More infos at <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_checkmode.html">DOCS</a>
        And see also <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_checkmode.html#using-diff-mode">DIFF-MODE</a>
.</li><br/>
</div>
</div>
</div>
<div class="foldable-container" id="foldcontainer-run-in-batches">
<h2 class="foldable-title" id="foldable-title-run-in-batches">run-in-batches</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('run-in-batches')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Ansible','editable-paragraph-run-in-batches', 'foldable-content-penButton-run-in-batches')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-run-in-batches">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-run-in-batches" onclick="save_editable_content('Ansible','editable-paragraph-run-in-batches', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-run-in-batches"><pre>- Playbook can be run in batches with <b>-e</b> see <a href="https://docs.tocco.ch/devops/app_management/ansible_usage.html#run-playbook-in-batches">Docs</a>
</pre></div>
</div>
</div>


<div class="foldable-container" id="foldcontainer-exclude-hosts">
<h2 class="foldable-title" id="foldable-title-exclude-hosts">exclude-hosts</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('exclude-hosts')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Ansible','editable-paragraph-exclude-hosts', 'foldable-content-penButton-exclude-hosts')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-exclude-hosts">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-exclude-hosts" onclick="save_editable_content('Ansible','editable-paragraph-exclude-hosts', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-exclude-hosts"><html><head></head><body><pre><code class="lang-bash">
#single
ansible tocco_servers --list-hosts -l '!tcserver01.tocco.ch'
</code>
</pre>


<pre><code class="lang-bash">
#multiple
ansible tocco_servers --list-hosts -l '!tcserver01.tocco.ch:!autorestore.tocco.ch'
</code>
</pre>


<pre><code class="lang-bash">
#playbook command
ansible tocco_servers --list-hosts -l '!tcserver01.tocco.ch:!autorestore.tocco.ch'
</code>
</pre>


<pre><code class="lang-bash">
#exclude hostgroup
ansible tocco_servers --list-hosts -l 'tocco_servers:!....:!.....'
</code>
</pre></body></html></div>
</div>
</div>
</div>
</div>
</div>
</body></html><!--## exclude-hosts #################################################################################################################--><!--## run-in-batches #################################################################################################################-->