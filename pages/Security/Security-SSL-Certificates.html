<!DOCTYPE html>
<html><head>
<title data-folder-path="/Security">Security-SSL-Certificates</title>
<link href=" ../../static/style.css" rel="stylesheet"/>
<link href="../../prism/prism.css" rel="stylesheet"/>
</head>
<body class="body">
<div class="page-folder-header-div">
<h1 class="pagetitle" data-folder-path="Security">Security-SSL-Certificates</h1>
<a href="./../..">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M3 11L12 4L21 11"></path>
<path d="M5 10V20H19V10"></path>
<path d="M10 20V14H14V20"></path>
</svg>
</a>
</div>
<!-- Sidebar -->
<div class="sidbear-enclosure-open" id="sidbear-enclosure-open-Security-SSL-Certificates">
<button class="sidbear-enclosure-button-open" id="sidbear-enclosure-button-Security-SSL-Certificates" onclick="toggle_sidebar()" type="button">
<svg fill="white" height="30" viewBox="0 0 100 80" width="30" xmlns="http://www.w3.org/2000/svg">
<rect height="10" width="100"></rect>
<rect height="10" width="100" y="30"></rect>
<rect height="10" width="100" y="60"></rect>
</svg>
</button>
<div class="sidebar-mainbox-open" id="sidebar-mainbox-Security-SSL-Certificates">
<div class="sidebar-subbox-open" id="sidebar-subbox-1" onclick=" append_foldable_content()">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" x2="12" y1="8" y2="16"></line>
<line x1="8" x2="16" y1="12" y2="12"></line>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-2">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
<div class="sidebar-subbox-open" id="sidebar-subbox-3">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9C9.32591 8.33109 9.78918 7.76807 10.4 7.41421C11.0108 7.06036 11.7266 6.93913 12.4152 7.07107C13.1038 7.20302 13.7206 7.57857 14.162 8.12132C14.6034 8.66407 14.8397 9.33984 14.83 10.03C14.83 12 12.5 12.5 12.5 14"></path>
<circle cx="12" cy="17" r="1"></circle>
</svg>
</div>
</div>
</div>
<script src="../../prism/prism.js"></script>
<script src="../../static/script.js"></script>
<!--## Security-SSL-Certificates-Certbot #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Security-SSL-Certificates-Certbot">
<h2 class="foldable-title" id="foldable-title-Security-SSL-Certificates-Certbot">Security-SSL-Certificates-Certbot</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Security-SSL-Certificates-Certbot')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Security-SSL-Certificates','editable-paragraph-Security-SSL-Certificates-Certbot', 'foldable-content-penButton-Security-SSL-Certificates-Certbot')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Security-SSL-Certificates-Certbot" onclick="add_subdiv('editable-paragraph-Security-SSL-Certificates-Certbot')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Security-SSL-Certificates-Certbot">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Security-SSL-Certificates-Certbot" onclick="save_editable_content('Security-SSL-Certificates','editable-paragraph-Security-SSL-Certificates-Certbot', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Security-SSL-Certificates-Certbot"><h3>Certbot Cronjob When Port 80 used By Webserver</h3>
<p>If you setup a certbot-cronjob or just execute certbot command by hand and there is also <br/>
a Webserver running, we might encounter an error:</p><br/>
<!--Prism bash pretyfier code example-->
    <pre>        <code class="lang-bash">
            certbot.errors.PluginError: Could not bind TCP port 80 because it is already in use by another process on this system (such as a web server).
            Please stop the program in question and then try again.        
        </code>
    </pre>
<li> Instead of stopping we can also do the certificate renewal via the Webserver </li><br/>
<li> first we need to install the certbot-nginx extension: 

<!--Prism bash pretyfier code example-->
    <pre>        <code class="lang-bash">
            sudo apt update
            sudo apt install certbot python3-certbot-nginx      
        </code>
    </pre>
</li><br/>
<li> Then we can execute the command or add it as a cronjob etc.:
<!--Prism bash pretyfier code example-->
    <pre>        <code class="lang-bash">
            sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com      
        </code>
    </pre>
In theory this should not restart the Webserver but only reload config ( no downtime ) 
</li><br/>
<li> Should probably be analog for <b>apache webserver</b> </li><br/></div>
</div>
</div>
<!--## Security-SSL-Certificates-Firewall-Issues #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Security-SSL-Certificates-Firewall-Issues">
<h2 class="foldable-title" id="foldable-title-Security-SSL-Certificates-Firewall-Issues">Security-SSL-Certificates-Firewall-Issues</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Security-SSL-Certificates-Firewall-Issues')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Security-SSL-Certificates','editable-paragraph-Security-SSL-Certificates-Firewall-Issues', 'foldable-content-penButton-Security-SSL-Certificates-Firewall-Issues')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Security-SSL-Certificates-Firewall-Issues" onclick="add_subdiv('editable-paragraph-Security-SSL-Certificates-Firewall-Issues')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Security-SSL-Certificates-Firewall-Issues">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Security-SSL-Certificates-Firewall-Issues" onclick="save_editable_content('Security-SSL-Certificates','editable-paragraph-Security-SSL-Certificates-Firewall-Issues', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Security-SSL-Certificates-Firewall-Issues"><pre>- On Hubertus you try to do 'certbot renew' but you get a failure ' something with challenge failed .... '


- In the past this was always related to the <b>ufw-firewall</b>


- we shutdown the apache-servers : sudo systemctl stop apache2.service


TIPS: If you wan't to know what runs on what Port ...:


   -  sudo netstat -tulnp | grep :$PORTNUMBER


- we disable the ufw firewall


- We can run the certbot renew command again


- If success we enable the ufw firewall again and restart the apache2 service</pre></div>
</div>
</div>
<!--## Purpose of the ssl-cert-snakeoil.key #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-Purpose of the ssl-cert-snakeoil.key">
<h2 class="foldable-title" id="foldable-title-Purpose of the ssl-cert-snakeoil.key">Purpose of the ssl-cert-snakeoil.key</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('Purpose of the ssl-cert-snakeoil.key')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Security-SSL-Certificates','editable-paragraph-Purpose of the ssl-cert-snakeoil.key', 'foldable-content-penButton-Purpose of the ssl-cert-snakeoil.key')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-Purpose of the ssl-cert-snakeoil.key" onclick="add_subdiv('editable-paragraph-Purpose of the ssl-cert-snakeoil.key')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-Purpose of the ssl-cert-snakeoil.key">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-Purpose of the ssl-cert-snakeoil.key" onclick="save_editable_content('Security-SSL-Certificates','editable-paragraph-Purpose of the ssl-cert-snakeoil.key', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-Purpose of the ssl-cert-snakeoil.key"><pre>🔑 <h3>What the snakeoil cert is</h3>

- Installed by default with ssl-cert package.
  Files live in <i>/etc/ssl/certs/ssl-cert-snakeoil.pem</i> and <b>/etc/ssl/private/ssl-cert-snakeoil.key</b>.

- Created during package install using openssl — signed by itself, not by a trusted CA.
  Permissions are locked down: the <b>private key</b> is only readable by the <b>ssl-cert group</b>.

- It's a server-specific public and private key pair created when the server's Debian based
  OS is installed (like Ubuntu). It is used in cases where no other SSL certificate is installed
  or configured, but encrypted communication is enabled and desired.

- While it does securely encrypt traffic, it is insecure and thus named 'snakeoil'
  because it's lack of root authority signature means it is vulnerable to the
  most simple man-in-the-middle attacks.

- Website administrators really need to reconfigure services that reference the snakeoil key
  with a properly signed key from their CA, like the one they hopefully use for HTTPS.
</pre></div>
</div>
</div>

<!--## TLS-Handshake #################################################################################################################-->
<div class="foldable-container" id="foldcontainer-TLS-Handshake">
<h2 class="foldable-title" id="foldable-title-TLS-Handshake">TLS-Handshake</h2>
<button class="foldable-content-unfoldbutton" id="foldable-content-unfoldbutton-newchapter" onclick="toggleFoldableContent('TLS-Handshake')" type="button">
<svg class="arrow-icon" fill="currentColor" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10l5 5 5-5H7z"></path>
</svg>
</button>
<button class="foldable-content-edittoggle" onclick="fetchEditableContent('Security-SSL-Certificates','editable-paragraph-TLS-Handshake', 'foldable-content-penButton-TLS-Handshake')" type="button">
<svg class="wrench-icon" fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M22.7 19.3l-4.1-4.1c.6-1.1.9-2.3.9-3.5 0-3.9-3.1-7-7-7-1.3 0-2.5.3-3.5.9l3.3 3.3-4 4-3.3-3.3C4.3 10.5 4 11.7 4 13c0 3.9 3.1 7 7 7 1.3 0 2.5-.3 3.5-.9l4.1 4.1c.4.4 1 .4 1.4 0l2.7-2.7c.4-.4.4-1 0-1.4z"></path>
</svg>
</button>
<button class="create-subdiv" id="create-subdiv-TLS-Handshake" onclick="add_subdiv('editable-paragraph-TLS-Handshake')" type='*button"'>
<svg class="add-tag-icon" fill="none" height="22" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
<!-- < and > symbols -->
<path d="M6 8l-4 4 4 4"></path> <!-- Left angle bracket -->
<path d="M18 8l4 4-4 4"></path> <!-- Right angle bracket -->
<!-- Plus sign in center -->
<path d="M12 10v4"></path>
<path d="M10 12h4"></path>
</svg>
</button>
<div class="foldable-content folded" id="foldable-content-TLS-Handshake">
<button class="foldable-content-penButton-hidden" id="foldable-content-penButton-TLS-Handshake" onclick="save_editable_content('Security-SSL-Certificates','editable-paragraph-TLS-Handshake', 'page-folder')" type="button">
<svg fill="none" height="30" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20h9"></path>
<path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
</svg>
</button>
<div class="editable-paragraph" contenteditable="false" id="editable-paragraph-TLS-Handshake"><html><head></head><body><pre> 
<div class="frame">This can for ex. be seen if we do a 
<pre><code class="lang-bash">
curl -vk https://${WHATEVER}
</code>
</pre></div>
<h3>Breaking down the TLS handshake you see:</h3>
  <pre><code class="lang-bash">
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
  </code></pre><p><b>The client (curl)</b> says “Hi server, I want to talk using TLSv1.3 and here are the cipher suites I support.”  
  No actual HTTP content is sent yet — it’s just negotiation.</p>
  <pre><code class="lang-bash">
* TLSv1.3 (IN), TLS handshake, Server hello (2):
  </code></pre><p><b>The server (Nginx)</b> responds with the chosen TLS version and cipher suite.  
  Also sends ephemeral key info for session encryption (Diffie-Hellman/X25519).</p>
  <pre><code class="lang-bash">
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
  </code></pre><p><b>Server is sending its certificate</b> (for ex. self-signed .crt) and proving it “owns” the corresponding private key.  
  Even though the cert is self-signed, this step completes the handshake for encryption.</p>
  <pre><code class="lang-bash">
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
  </code></pre><p><b>Both sides confirm session keys</b> are established.  
  From this point onward, <b>all HTTP requests and responses are encrypted</b> using symmetric keys derived during the handshake.</p>
  <h3>Key points</h3>
    <li><b>TLSv1.3</b> → modern, secure encryption protocol.</li>
    <li><b>Change cipher spec / Finished messages</b> → signal that session keys are in use.</li>
    <li><b>Everything after this is encrypted</b> — even though the cert is self-signed, the encryption is fully functional.</li>
</pre></body></html></div>
</div>
</div>
</body></html>